<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Dashboard de Faturas</title>
  <link rel="icon" type="image/x-icon" href="./assets/favicon.png">
  <link rel="apple-touch-icon" href="./assets/favicon-app.png">
  <link rel="stylesheet" href="./css/common.css" />
  <link rel="stylesheet" href="./css/invoiceDashboard.css" />
  <link rel="stylesheet" href="./css/classesInfo.css" />
  <link rel="stylesheet" href="./css/salarySimulationCalendar.css" />
  <link rel="stylesheet" href="./css/entitiesList.css" />
  <link rel="stylesheet" href="./css/mobile.css" />
</head>
<body>

  <!-- Sidebar Menu (hidden by default) -->
  <div id="sidebar">
    <div>
      <div class="sidebar-menu" id="menuInvoiceDashboard">
        <span class="sidebar-icon">üìä</span>
        <span class="sidebar-label">Dashboard</span>
      </div>
      <div class="sidebar-menu" id="menuClassesInfo">
        <span class="sidebar-icon">üè∑Ô∏è</span>
        <span class="sidebar-label">Valores por Aula</span>
      </div>
      <div class="sidebar-menu" id="menuSalarySimulation">
        <span class="sidebar-icon">üóìÔ∏è</span>
        <span class="sidebar-label">Simula√ß√£o Vencimento</span>
      </div>
      <div class="sidebar-menu" id="menuEntities">
        <span class="sidebar-icon">üè¢</span>
        <span class="sidebar-label">Lista de Entidades</span>
      </div>
    </div>
    <button id="sidebarToggle" title="Expandir/Recolher Menu" style="margin: 16px 0 18px 8px; background: none; border: none; cursor: pointer; font-size: 1.3em;">
      <span id="sidebarToggleIcon">‚¨ÖÔ∏è</span>
    </button>
  </div>

  <!-- Main invoice dashboard -->
  <header>
    <h1 id="pageTitle">üìä Faturas-Recibo Emitidas
      <span id="infoIcon" title="Informa√ß√£o" style="cursor:pointer; margin-left:0.5em; font-size:0.8em;">‚ÑπÔ∏è</span>
    </h1>
    <div id="year-toggle-id" class="year-toggle">
      <label for="yearSelect">Ano:</label>
      <select id="yearSelect" class="year-select"></select>
        <span id="refreshBtn" title="Atualizar Dados" tabindex="0" role="button"></span>
    </div>
  </header>

  <main>
    <section class="left">
      <table id="invoiceTable">
        <thead>
          <tr>
            <th>NIF</th>
            <th>ENTIDADE</th>
            <th>VALOR</th>
            <th>DATA EMISS√ÉO</th>
            <th>DATA SERVI√áO</th>
            <th>Trimestre</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section class="right">
      <div class="panel" id="quarterPanel">
        <h3>Resumo Trimestral</h3>
        <div id="quarterSummary"></div>
        <p><strong>Total Anual:</strong> <span id="totalYearValue" class="total-value">0.00 ‚Ç¨</span></p>
      </div>

      <div class="panel" id="taxPanel">
        <h3>Estado Fiscal</h3>
        <div class="fiscal-item">
        <span class="fiscal-label">Pagamento IVA</span>
        <span class="fiscal-icon green">‚ùå</span>
        </div>
        <div class="fiscal-item">
        <span class="fiscal-label">Reten√ß√£o na Fonte</span>
        <span class="fiscal-icon red">‚ùå</span>
        </div>
        <div class="fiscal-item">
        <span class="fiscal-label">Pagamento IRS</span>
        <span class="fiscal-icon green">‚ùå</span>
        </div>
      </div>

      <div class="panel" id="nifStatsPanel">
        <h3>Faturas por NIF</h3>
        <ul id="nifStats"></ul>
        <p><strong>Total de Faturas:</strong> <span id="totalInvoices" class="total-value">0</span></p>
      </div>
    </section>
  </main>

  <!-- Classes Table Panel (hidden by default) -->
  <div id="classesInfoPanel" style="display:none;">
    <div class="year-toggle">
      <label for="classesYearSelect">Ano:</label>
      <select id="classesYearSelect" class="year-select"></select>
    </div>
    
    <table id="classesInfoTable">
      <thead>
      <tr>
        <th id="sortClassNif" style="cursor:pointer;">NIF ‚ñ≤‚ñº</th>
        <th id="sortClassEntidade" style="cursor:pointer;">ENTIDADE ‚ñ≤‚ñº</th>
        <th id="sortClassCount" style="cursor:pointer;">N¬∫ Aulas/Semana ‚ñ≤‚ñº</th>
        <th id="sortClassValue" style="cursor:pointer;">Valor/Aula ‚ñ≤‚ñº</th>
        <th id="sortClassVariation" style="cursor:pointer;">Varia√ß√£o ‚ñ≤‚ñº</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Salary Simulation Calendar Panel (hidden by default) -->
  <div id="salarySimulationPanel" style="display:none;">
    <div id="salaryCalendar"></div>
  </div>

  <!-- Entities Table Panel (hidden by default) -->
  <div id="entitiesPanel" style="display:none;">
    <table id="entitiesTable">
      <thead>
        <tr>
          <th id="sortNif" style="cursor:pointer;">NIF ‚ñ≤‚ñº</th>
          <th id="sortEntidade" style="cursor:pointer;">ENTIDADE ‚ñ≤‚ñº</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Info Dialog -->
  <div id="infoDialog" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35); z-index:99999; align-items:center; justify-content:center;">
    <div style="background:#fff; padding:2em; border-radius:10px; max-width:90vw; max-height:80vh; overflow:auto; box-shadow:0 4px 24px rgba(0,0,0,0.18); position:relative;">
      <button id="closeInfoDialog" style="position:absolute; top:0.5em; right:0.5em; background:none; border:none; font-size:1.3em; cursor:pointer;">‚úñÔ∏è</button>
      <h2>Sobre o Dashboard</h2>
      <p>
        IVA (https://www.vendus.pt/blog/isencao-iva-artigo-9-53/)	<br>
        NIF come√ßados por 5 s√£o empresas > Isento IVA Art.¬∫53	<br>
        NIFS come√ßados por 1, 2 OU 3 s√£o singulares > Isento IVA Art.¬∫ 9 <br>
        IVA - Regime de Isen√ß√£o <br>
        <br><br>	
        IRS (Reten√ßao na fonte)	<br>
        NIF come√ßados por 5 s√£o empresas > Dispensa de reten√ß√£o - art. 101.¬∫-B,n.¬∫1,al. a) e b), do CIRS <br>	
        NIFS come√ßados por 1, 2 OU 3 s√£o singulares > Sem reten√ß√£o - Art.101¬∫, n.¬∫1 do CIRS	
      </p>
    </div>
  </div>

  <!-- Loading Mask -->
  <div id="loadingOverlay" style="display:none;">
    <div class="loading-spinner"></div>
    <div class="loading-text">A carregar dados...</div>
  </div>

  <script src="config/secrets.js"></script>
  <script type="module" src="./js/main.js"></script>
</body>
</html>
