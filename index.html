<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard de Faturas</title>
  <link rel="icon" type="image/x-icon" href="./assets/favicon.png">
  <link rel="apple-touch-icon" href="./assets/favicon.png">
  <link rel="stylesheet" href="./css/style.css" />
</head>
<body>

  <!-- Sidebar Menu (hidden by default) -->
  <div id="sidebar">
    <div class="sidebar-menu" id="menuDashboard">
      <span class="sidebar-icon">ğŸ“Š</span>
      <span class="sidebar-label">Dashboard</span>
    </div>
    <div class="sidebar-menu" id="menuClasses">
      <span class="sidebar-icon">ğŸ·ï¸</span>
      <span class="sidebar-label">Valores por Aula</span>
    </div>
    <div class="sidebar-menu" id="menuSalarySim">
      <span class="sidebar-icon">ğŸ—“ï¸</span>
      <span class="sidebar-label">SimulaÃ§Ã£o Vencimento</span>
    </div>
    <div class="sidebar-menu" id="menuEntities">
      <span class="sidebar-icon">ğŸ¢</span>
      <span class="sidebar-label">Lista de Entidades</span>
    </div>
  </div>

  <!-- Main invoice dashboard -->
  <header>
    <h1 id="pageTitle">ğŸ“Š Faturas-Recibo Emitidas
      <span id="infoIcon" title="InformaÃ§Ã£o" style="cursor:pointer; margin-left:0.5em; font-size:0.8em;">â„¹ï¸</span>
    </h1>
    <div id="year-toggle">
        <label for="yearSelect">Ano:</label>
        <select id="yearSelect"></select>
        <span id="refreshBtn" title="Atualizar Dados" tabindex="0" role="button"></span>
    </div>
  </header>

  <main>
    <section class="left">
      <table id="invoiceTable">
        <thead>
          <tr>
            <th>NIF</th>
            <th>ENTIDADE</th>
            <th>VALOR</th>
            <th>DATA EMISSÃƒO</th>
            <th>DATA SERVIÃ‡O</th>
            <th>Trimestre</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section class="right">
      <div class="panel" id="quarterPanel">
        <h3>Resumo Trimestral</h3>
        <div id="quarterSummary"></div>
        <p><strong>Total Anual:</strong> <span id="totalYearValue" class="total-value">0.00 â‚¬</span></p>
      </div>

      <div class="panel" id="taxPanel">
        <h3>Estado Fiscal</h3>
        <div class="fiscal-item">
        <span class="fiscal-label">Pagamento IVA</span>
        <span class="fiscal-icon green">âŒ</span>
        </div>
        <div class="fiscal-item">
        <span class="fiscal-label">RetenÃ§Ã£o na Fonte</span>
        <span class="fiscal-icon red">âŒ</span>
        </div>
        <div class="fiscal-item">
        <span class="fiscal-label">Pagamento IRS</span>
        <span class="fiscal-icon green">âŒ</span>
        </div>
      </div>

      <div class="panel" id="nifStatsPanel">
        <h3>Faturas por NIF</h3>
        <ul id="nifStats"></ul>
        <p><strong>Total de Faturas:</strong> <span id="totalInvoices" class="total-value">0</span></p>
      </div>
    </section>
  </main>

  <!-- Salary Simulation Calendar Panel (hidden by default) -->
  <div id="salarySimPanel" style="display:none;">
    <div id="salaryCalendar"></div>
  </div>

  <!-- Classes Table Panel (hidden by default) -->
  <div id="classesPanel" style="display:none;">
    <table id="classesTable">
      <thead>
        <tr>
          <th id="sortClassNif" style="cursor:pointer;">NIF â–²â–¼</th>
          <th id="sortClassEntidade" style="cursor:pointer;">ENTIDADE â–²â–¼</th>
          <th id="sortClassCount" style="cursor:pointer;">NÂº Aulas/Semana â–²â–¼</th>
          <th id="sortClassValue" style="cursor:pointer;">Valor/Aula â–²â–¼</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Entities Table Panel (hidden by default) -->
  <div id="entitiesPanel" style="display:none;">
    <table id="entitiesTable">
      <thead>
        <tr>
          <th id="sortNif" style="cursor:pointer;">NIF â–²â–¼</th>
          <th id="sortEntidade" style="cursor:pointer;">ENTIDADE â–²â–¼</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Info Dialog -->
  <div id="infoDialog" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35); z-index:99999; align-items:center; justify-content:center;">
    <div style="background:#fff; padding:2em; border-radius:10px; max-width:90vw; max-height:80vh; overflow:auto; box-shadow:0 4px 24px rgba(0,0,0,0.18); position:relative;">
      <button id="closeInfoDialog" style="position:absolute; top:0.5em; right:0.5em; background:none; border:none; font-size:1.3em; cursor:pointer;">âœ–ï¸</button>
      <h2>Sobre o Dashboard</h2>
      <p>
        IVA (https://www.vendus.pt/blog/isencao-iva-artigo-9-53/)	<br>
        NIF comeÃ§ados por 5 sÃ£o empresas > Isento IVA Art.Âº53	<br>
        NIFS comeÃ§ados por 1, 2 OU 3 sÃ£o singulares > Isento IVA Art.Âº 9 <br>
        IVA - Regime de IsenÃ§Ã£o <br>
        <br><br>	
        IRS (RetenÃ§ao na fonte)	<br>
        NIF comeÃ§ados por 5 sÃ£o empresas > Dispensa de retenÃ§Ã£o - art. 101.Âº-B,n.Âº1,al. a) e b), do CIRS <br>	
        NIFS comeÃ§ados por 1, 2 OU 3 sÃ£o singulares > Sem retenÃ§Ã£o - Art.101Âº, n.Âº1 do CIRS	
      </p>
    </div>
  </div>

  <!-- Loading Mask -->
  <div id="loadingOverlay" style="display:none;">
    <div class="loading-spinner"></div>
    <div class="loading-text">A carregar dados...</div>
  </div>

  <script src="config/secrets.js"></script>
  <script type="module" src="./js/main.js"></script>
</body>
</html>
